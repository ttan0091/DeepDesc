Type of vulnerability: Incorrect Peg Balances Calculation
Cause of vulnerability: The `sumTokensInPeg` function incorrectly includes the self-insurance amount in the pool's reported balance, leading to inaccurate balance calculations used for deposit limit enforcement.
Effects of vulnerability: Users may experience unexpected failures during deposit attempts due to the incorrect balance calculations, which can cause them to lose gas fees and potentially miss opportunities to deposit funds.
Immediate fix: Modify the `sumTokensInPeg` function to properly exclude the self-insurance amount from the reported balance, ensuring that deposit limit checks are based on the actual pool balance without self-insurance.