Type of vulnerability: Reentrancy
Cause of vulnerability: Incorrect array length check in the _lastSnapshotId function, which allows the core logic to be executed when the function is called with an empty array.
Working of the vulnerability: An attacker can manipulate the dummy snapshot state of the token to mint and transfer tokens for free through multiple metered transactions and withdrawals, simulating the passage of time to reach a point where the accrued debt is greater than the liquidation threshold.
Potential Mitigations: Ensure that the core logic functions check for an empty array before proceeding, or alternate methods of state storage such as global variables or reordering the logic to avoid this issue.