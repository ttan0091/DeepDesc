Type of vulnerability: Incorrect Token Balance Calculation
Cause of vulnerability: Rounding errors in the calculation of the Peg equivalent value of the underlying asset
Explanation of the vulnerability: When tokens are deposited, their value is divided by the Peg equivalent multiplied by Peg decimals. Since these values are multiplied, converting them back results in rounding errors, leading to an increased total supply.
Working process of the vulnerable code: The sumTokensInPeg function calculates the Peg equivalent of the underlying tokens, rounds it down to the nearest integer, and updates the total supply. However, when this value is converted back to the underlying token decimals, it may round up, causing discrepancies in balance calculations.
Impact of the vulnerability: The vulnerability results in balance inaccuracies, particularly for small deposits, leading to failed transfers and withdrawals due to the contract's require conditions.