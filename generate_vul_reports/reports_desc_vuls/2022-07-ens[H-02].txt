Type of vulnerability: Time of Check to Time of Use (TOCTOU)
Cause of vulnerability: Unwrapping a parent node sets its expiry to zero, allowing a subsequent re-wrap to set an expiry smaller than its child nodes.
Execution process: A hacker unwraps a sub-domain, then re-wraps it with a smaller expiry than its sub-sub-domain, violating the expiry hierarchy.
Vulnerable code: `function_getDataAndNormaliseExpiry(bytes32 parentNode, bytes32 node, uint64 expiry) internal view returns (address owner, uint32 fuses, uint64) { uint64 oldExpiry; (owner, fuses, oldExpiry) = getData(uint256(node)); ( , , uint64 maxExpiry) = getData(uint256(parentNode)); expiry = _normaliseExpiry(expiry, oldExpiry, maxExpiry); return (owner, fuses, expiry); }`