[H-06] Users are credited more tokens when paying back debt withregisterTradeAndBorrow
TheregisterTradeAndBorrowis called with the results of a trade (inAmount,outAmount). It first tries to pay back any debt with theoutAmount. However, thefulloutAmountis credited to the user again as a deposit in theadjustAmounts(account, tokenFrom, tokenTo, sellAmount, outAmount);call. As the user pays back their debt and is credited the same amount again, they are essentially credited twice theoutAmount, making a profit of oneoutAmount. This can be withdrawn and the process can be repeated until the funds are empty.
In theadjustAmountscall, it should only creditoutAmount - extinguishableDebtas a deposit like inregisterDeposit.
TheregisterDepositfunction correctly handles this case.