[H-03]Beebots.TradeValid()Will Erroneously Return True When Maker Is Set ToAddress(0)andmakerIdsAre Set To TheTokenIdsof Unminted Beebot NFTs
Beebots.TradeValid()will erroneously return true whenmakeris set toaddress(0)andmakerIdsare set to thetokenIdsof unminted beebot NFTs.
Beebots.verify()returns true no matter what signature is given when signer is set toaddress(0). This means thatBeeBots.tradeValid()will erroneously return true whenmakeris set toaddress(0).
Finally, before an NFT has even been minted at all, it is assumed to have an owner ofaddress(0)due to theidToOwnermapping being initialized to zero for all uninitialized slots, so an attacker can calltradeValid()withmakerset toaddress(0)andmakerIdsset to thetokenIdsof any unmintednftIds, andtradeValid()will erroneously return true.
(1)Beebots.verify()returns true no matter what signature is given when signer is set toaddress(0).(1a)BeeBots.verify()does not check to ensure that signer is notaddress(0).(1b) This is a problem becauseecrecoverfails silently if the signature does not match and returns zero.(1c) So if an attacker passes inaddress(0)as the signer, then verify will return true no matter what signature is provided, sinceecrecoverwill returnaddress(0), and the signer isaddress(0), so verify will pass.(1d) This means thatBeeBots.tradeValid()will erroneously return true when maker is set toaddress(0).(2) Before an NFT has even been minted at all, it is assumed to have an owner ofaddress(0)due to theidToOwnermapping being initialized to zero for all uninitialized slots(2a) Solidity initializes all mappings to 0 for all slots that have not yet been set.(2b) So for any NFT ID that has not yet been minted, the corresponding owner in the mappingBeeBots.idToOwnerisaddress(0), even though that NFT should not even exist.(2c) This means that an attacker can calltradeValid()with maker set toaddress(0)and makerIds set to any unminted nftIds, andtradeValid()will erroneously return true.
(1) Recommend adding this check toBeebots.verify():require(signer != address(0), "Cannot verify signatures from 0x0");
(2) Recommend adding this check toBeebots.tradeValid():require(maker != address(0), "Maker 0x0 not allowed");
dangerousfood (Meebits) commented:
Wow, this exploit is absolutely stunning.