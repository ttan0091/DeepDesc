[H-09] Bad debts should not continue to accrue interest
Submitted by WatchPug
NFTVault.sol#L844-L851
uint256debtAmount=_getDebtAmount(_nftIndex);require(debtAmount>=_getLiquidationLimit(_nftIndex),"position_not_liquidatable");// burn all paymentstablecoin.burnFrom(msg.sender,debtAmount);
In the current design/implementation, the liquidator must fully repay the user’s outstanding debt in order to get the NFT.
When the market value of the NFT fell rapidly, the liquidators may not be able to successfully liquidate as they can not sell the NFT for more than the debt amount.
In that case, the protocol will have positions that are considered bad debts.
However, these loans, which may never be repaid, are still accruing interest. And every time the DAO collects interest, newstablecoinwill be minted.
When the proportion of bad debts is large enough since the interest generated by these bad debts is not backed. It will damage the authenticity of the stablecoin.
Proof of Concept
Given:
NFT 1worth 30,000 USDcreditLimitRate= 60%liquidationLimitRate= 50%debtInterestApr= 10%Alice borrowed10,000 USDwithNFT #1;After 1 year,NFT 1’s market value in USD has suddenly dropped to10,000USD, no liquidator is willing to repay 11,000 USD forNFT #1;The DAOcollect()and minted1,000stablecoin;After 1 year, the DAO callcollect()will mint1,100stablecoin. and so on…
Recommended Mitigation Steps
Consider adding a stored value to record the amount of bad debt, and add a public function that allows anyone to mark a bad debt to get some reward. and changeaccrueto:
uint256internalbadDebtPortion;functionaccrue()public{uint256additionalInterest=_calculateAdditionalInterest();totalDebtAccruedAt=block.timestamp;totalDebtAmount+=additionalInterest;uint256collectibleInterest=additionalInterest* (totalDebtPortion-badDebtPortion) /totalDebtPortion;totalFeeCollected+=collectibleInterest;}
spaghettieth (JPEG’d) acknowledged, but disagreed with High severity
LSDan (judge) commented:
I agree with the warden. Left unchecked, this issue is almost certain to occur and will cause substantial negative impacts on the protocol. The only way this would not occur is if the NFT market never crashes.