[H-02]FSDVesting: Claiming tributes should call FSD token’s corresponding functions
Submitted by hickuphh3, also found by leastwood
Impact
The claiming of staking and governance tributes for the a beneficiary’s vested tokens should be no different than other users / EOAs. However, theclaimTribute()andclaimGovernanceTribute()are missing the actual claiming calls to the corresponding functions of the FSD token contract. As a result, the accrued rewards are taken from the beneficiary’s vested token while not claiming (replenishing) from the FSD token contract.
Recommended Mitigation Steps
In addition to what has been mentioned above, the internal accounting for claimedTribute states can be removed because they are already performed in the FSD token contract.
// TODO: Remove _claimedTribute and _claimedGovernanceTribute mappings/***@devAllows claiming of staking tribute by`msg.sender`during their vesting period.* It updates the claimed status of the vest against the tribute* being claimed.** Requirements:* - claiming amount must not be 0.*/functionclaimTribute(uint256num)externalonlyBeneficiary{uint256tribute=fsd.availableTribute(num);require(tribute!=0,"FSDVesting::claimTribute: No tribute to claim");fsd.claimTribute(num);fsd.safeTransfer(msg.sender,tribute);emitTributeClaimed(msg.sender,tribute);}/***@devAllows claiming of governance tribute by`msg.sender`during their vesting period.* It updates the claimed status of the vest against the tribute* being claimed.** Requirements:* - claiming amount must not be 0.*/functionclaimGovernanceTribute(uint256num)externalonlyBeneficiary{uint256tribute=fsd.availableGovernanceTribute(num);require(tribute!=0,"FSDVesting::claimGovernanceTribute: No governance tribute to claim");fsd.claimGovernanceTribute(num);fsd.safeTransfer(msg.sender,tribute);emitGovernanceTributeClaimed(msg.sender,tribute);}
YunChe404 (FairSide) confirmed