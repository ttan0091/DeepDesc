[H-05] Wrong liquidation logic
ThebelowMaintenanceThresholdfunction decides if a trader can be liquidated:
functionbelowMaintenanceThreshold(CrossMarginAccountstorageaccount)internalreturns(bool){uint256loan=loanInPeg(account,true);uint256holdings=holdingsInPeg(account,true);// The following should hold:// holdings / loan >= 1.1// =>return100*holdings>=liquidationThresholdPercent*loan;}
The inequality in the last equation is wrong because it says the higher the holdings (margin + loan) compared to the loan, the higher the chance of being liquidated. The inverse equality was probably intendedreturn 100 * holdings <= liquidationThresholdPercent * loan;. Users that shouldnâ€™t be liquidated can be liquidated, and users that should be liquidated cannot get liquidated.